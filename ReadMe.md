# Плагин ScheduleCreation
## Назначение плагина
Плагин **ScheduleCreation** предназначен для создания спецификации стен и ее выноса на лист
## Класс Command
Является основным классом программы для связи с Revit. Реализует метод **Execute**.

В рамках реализации метода происходит создание вида спецификации и добаление данного вида на вновь созданный лист.
## Класс ScheduleCreationUtility
Вспомогательный класс, в рамках которого производится формирование нового вида спецификации стен, размещение вида спецификации на листе и проверка параметров для отображения.

Содержит несколько методов, один из которых **CreateAndAddSchedules** является публичным и реализуетися в **Command**, прочие являются приватными. Также содержит поле с массивом _BuiltInParameter[]_ **s_skipParameters**, которые должны пропускаться плагином.

Сначала создается спецификация, затем спецификация размещается на листе.

В качестве аргумента принмает _UIDocument_ текущего файла Revit.
### Метод _public_ CreateAndAddSchedules
Публичный метод, в котором заводится группа транзакций для создания вида ведомости, листа для размещения и размещения ведомости на листе.

Пока все транзакции в рамках группы не будут выполнены, транзпкция не будет является успешно завершенной. Если одна из транзакций в группе будет провальной - изменения от предыдущих транзакций в группе будут отказываться до исходного состояния.
### Метод _private_ CreateSchedules
В рамках метода заводится транзакция _"Create Schedules"_, в рамках которой в документе создается ведомость стен с именем "_Wall Schedule 1"_.

Формируется список видов ведомостей для категории элементов _"Стены"_, id которых являются валидными.

В созданном виде ведомости определяется перечень полей-параметров, доступных для категории _"Стены"_.

Добавляются поля, которые относятся к экземпляру элемента, параметры типа пропускаюся.

Если параметр находится в массиве **s_skipParameters** - он пропускается.

Для встроенных параметров (BuiltInParameter) производится дополнительная проверка по типу данных. Если тип данных текст или Id - производится увеличение ширины поля и выравнивание по левому краю. Для прочих случаев производится выравнивание по центру.

Дополнительно производится фильтрация элементов, объем которых менее или равен 0,8 м<sup>3</sup>. Создается фильтр в ведомости по параметру Объем и сначением больше 0.8 м<sup>3</sup>.

Также производится группировка и сортировка ведомости по параметру **Тип**.

В качестве аргумента метод принимает _UIDocument_ текущего файла Revit.
### Метод _private_ AddScheduleToNewSheet
В рамках метода заводится транзакция _"Create and populate sheet"_ в рамках которой выполняется создание нового листа и вставка созданной ведомости на этот лист.

В документе собираются все доступные типы основных надписей, из которых в качестве рабочего принимается первый найденный тип.

Создается новый лист с найденным типом основной надписи с именем _"Sheet for Wall Schedule 1"_ (код метода подразумевает более открытое название, но фактически имя ведомости жестко задано в рамках метода **CreateSchedules**), после чего производится принудительная регенерация документа для вступления изменений в силу до завершения транзакции.

Далее определяется точка вставки ведомости на лист - на вновь созанном листе определяется BoundingBox основной надписи - для определения левой верхней точки, после чего определяется точка вставки ведомости, путем задания фиксированного смещения.

Ведомость размещается на листе.

В качетсве аргументов метод принимает текущий документ проекта и вид спецификации для размещения.
### Метод _private_ ShouldSkip
Вспомогательный метод для опредления вхождения id параметра в массив для исключения _s_skipParameters_
## Ошибки
При повторном запуске команды в одном и том же проекте Revit появится предупреждение, что имена должны быть уникальными. Связано скорее всего с жестким заданием имени ведомости в методе **CreateSchedules** и, как следствие в методе **AddScheduleToNewSheet**. Команда при этом не выполняется.
